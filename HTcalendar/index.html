<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>é»‘é“å®æ—¶æ—¥å†</title>
<link rel="stylesheet" href="../css/htgov.css" />
  <script src="https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>
<style>
/* è®¡æ—¶å™¨å®¹å™¨æ ·å¼ */
.timer-container {
  background: rgba(255, 255, 255, 0.1);
  border-radius: 15px;
  padding: 20px;
  margin-top: 30px;
  backdrop-filter: blur(10px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
  display: none; 
}

.timer-controls {
  display: flex;
  justify-content: center;
  margin-bottom: 20px;
  border-bottom: 1px solid rgba(255, 255, 255, 0.2);
  padding-bottom: 10px;
}

.timer-mode-btn {
  background: rgba(255, 255, 255, 0.1);
  border: none;
  color: #fff;
  padding: 10px 25px;
  margin: 0 5px;
  border-radius: 20px;
  font-size: 16px;
  cursor: pointer;
  transition: all 0.3s ease;
}

.timer-mode-btn.active {
  background: rgba(59, 130, 246, 0.7);
  box-shadow: 0 4px 15px rgba(59, 130, 246, 0.4);
}

.timer-section {
  display: none;
}

.timer-section.active {
  display: block;
}

/* æ—¶é—´æ˜¾ç¤ºæ ·å¼ */
.time-display {
  font-size: 48px;
  font-weight: bold;
  text-align: center;
  margin: 20px 0;
  font-family: 'Courier New', monospace;
  color: #fff;
  text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
}

/* æ§åˆ¶æŒ‰é’®æ ·å¼ */
.control-btn {
  background: rgba(255, 255, 255, 0.15);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  padding: 12px 25px;
  margin: 0 10px;
  border-radius: 8px;
  font-size: 16px;
  cursor: pointer;
  transition: all 0.3s ease;
}

.control-btn:hover {
  background: rgba(255, 255, 255, 0.25);
  transform: translateY(-2px);
}

.control-btn:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

/* æ—¶é—´è®¾ç½®æ ·å¼ */
.time-setup {
  display: flex;
  justify-content: center;
  gap: 15px;
  margin: 25px 0;
}

.time-input-group {
  display: flex;
  flex-direction: column;
  align-items: center;
}

.time-input-group input {
  width: 80px;
  padding: 12px;
  font-size: 24px;
  text-align: center;
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.3);
  border-radius: 8px;
  color: white;
  margin-bottom: 5px;
}

.time-input-group span {
  color: rgba(255, 255, 255, 0.8);
  font-size: 14px;
}

/* å¿«é€Ÿé¢„è®¾æŒ‰é’® */
.quick-presets {
  display: flex;
  justify-content: center;
  gap: 10px;
  margin: 20px 0;
  flex-wrap: wrap;
}

.preset-btn {
  background: rgba(59, 130, 246, 0.3);
  border: 1px solid rgba(59, 130, 246, 0.5);
  color: white;
  padding: 8px 15px;
  border-radius: 6px;
  cursor: pointer;
  transition: all 0.3s ease;
}

.preset-btn:hover {
  background: rgba(59, 130, 246, 0.5);
}

/* æé†’é€‰é¡¹æ ·å¼ */
.reminder-options {
  display: flex;
  justify-content: center;
  align-items: center;
  margin: 25px 0;
  gap: 15px;
}

.reminder-options label {
  color: white;
  font-size: 16px;
}

.reminder-buttons {
  display: flex;
  gap: 10px;
}

.reminder-btn {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  padding: 8px 20px;
  border-radius: 6px;
  cursor: pointer;
  transition: all 0.3s ease;
}

.reminder-btn.active {
  background: rgba(34, 197, 94, 0.5);
  border-color: rgba(34, 197, 94, 0.7);
}

/* è®¡æ¬¡å®¹å™¨æ ·å¼ */
.lap-container {
  max-height: 200px;
  overflow-y: auto;
  margin-top: 20px;
  padding: 10px;
  background: rgba(0, 0, 0, 0.2);
  border-radius: 8px;
}

.lap-item {
  padding: 8px 15px;
  border-bottom: 1px solid rgba(255, 255, 255, 0.1);
  color: white;
  font-family: 'Courier New', monospace;
}

.lap-item:last-child {
  border-bottom: none;
}

/* å…¨å±æé†’æ ·å¼ */
.fullscreen-alert {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: linear-gradient(135deg, #1e40af 0%, #0ea5e9 100%);
  display: none;
  justify-content: center;
  align-items: center;
  z-index: 9999;
  cursor: pointer;
}

.alert-content {
  text-align: center;
  animation: pulse 2s infinite;
}

.alert-content h1 {
  font-size: 72px;
  color: gold;
  text-shadow: 0 0 20px rgba(255, 215, 0, 0.7);
  margin-bottom: 20px;
}

.alert-content p {
  font-size: 36px;
  color: #fffbeb;
  margin-bottom: 30px;
}

.hint {
  font-size: 20px !important;
  color: rgba(255, 251, 235, 0.7) !important;
  margin-top: 40px !important;
}

@keyframes pulse {
  0% { transform: scale(1); }
  50% { transform: scale(1.05); }
  100% { transform: scale(1); }
}
	/* å¼€å…³æ ·å¼ */
.switch input {
  opacity: 0;
  width: 0;
  height: 0;
}

.switch input:checked + .slider {
  background-color: #4CAF50;
}

.switch input:checked + .slider:before {
  transform: translateX(36px);
}

/* å¼€å…³æ ‡ç­¾æ–‡å­—åŠ¨ç”» */
#toggle-label {
  transition: all 0.3s ease;
  font-weight: bold;
}

.switch input:checked ~ #toggle-label {
  color: #4CAF50;
}
</style>
        </head>
        <body>
            <div class="header">
                <a href="https://htcb-12c7.github.io/htgov/">
                    <img class="logo" src="../assets/HTgovIconV2.png" alt="è¿”å›ä¸»é¡µ">
                </a>
                é»‘é“å®æ—¶æ—¥å† <span>å¤šç§æ—¶é—´/æ—¥å†</span>
                
                <!-- Language æŒ‰é’® -->
                <button id="lang-toggle" style="
                    position: absolute;
                    top: 10px;
                    right: 70px;
                    padding: 8px 16px;
                    font-size: 16px;           /* å­—ä½“å¤§å° */
                    background: black;
                    color: #03a9f4;
                    border: 1px solid #03a9f4;
                    border-radius: 5px;
                    cursor: pointer;
                    font-weight: bold;
                ">
                ğŸŒ Language
                </button>

<!-- å¤´åƒ + å¼¹å‡ºå¡ç‰‡ -->
<div class="account-toggle" style="position: absolute; top: 10px; right: 10px;">
  <img id="userPhoto" src="https://htcb-12c7.github.io/htgov/assets/login-placeholder.svg" alt="å¤´åƒ"
    style="width: 40px; height: 40px; border-radius: 50%; cursor: pointer;"
    onclick="toggleAccountInfo()" />

  <div class="account-popup" id="accountPopup" style="
    display: none;
    position: absolute;
    top: 45px;
    right: 0;
    background: rgba(0,0,0,0.9);
    padding: 10px 15px;
    border-radius: 8px;
    color: white;
    z-index: 9999;
    box-shadow: 0 0 10px rgba(0,0,0,0.5);
    white-space: nowrap;
  ">

    <!-- æœªç™»å½•æ˜¾ç¤ºç™»å½•è¡¨å• -->
    <div id="loginForm">
      <input type="email" id="email" placeholder="é‚®ç®±/ç”¨æˆ·å" style="width: 150px; margin: 3px;" />
      <input type="password" id="password" placeholder="å¯†ç " style="width: 150px; margin: 3px;" />
      <button id="loginBtn">ç™»å½•</button>
      <button id="googleLoginBtn" style="background:#fff; color:#000; margin-top:5px;">ä½¿ç”¨ Google ç™»å½•</button>
    </div>

    <!-- ç™»å½•åæ˜¾ç¤º/ä¿®æ”¹ç”¨æˆ·ä¿¡æ¯ -->
    <div id="userInfo" style="display:none;">
      <!-- å¤´åƒä¸Šä¼  -->
      <div>
        <label>å¤´åƒï¼š</label>
        <input type="file" id="updateAvatar" accept="image/*" />
        <img id="userPhotoPreview" 
             src="https://htcb-12c7.github.io/htgov/assets/login-placeholder.svg"
             style="width:60px; height:60px; border-radius:50%; margin-top:5px;" />
      </div>
      <div><strong>æ˜µç§°ï¼š</strong><input id="userNickname" /></div>
      <div>
        <strong>é‚®ç®±ï¼š</strong>
        <input id="userEmail" style="width:200px;" />
        <button id="sendVerifyBtn" style="margin-left:5px;">å‘é€éªŒè¯é‚®ä»¶</button>
      </div>
      <div><strong>æ”¯ä»˜æ–¹å¼ï¼š</strong><input id="userPayMethod" /></div>
      <div><strong>æ”¯ä»˜åç§°ï¼š</strong><input id="userPayName" /></div>
      <div><strong>æ”¯ä»˜è´¦å·ï¼š</strong><input id="userPayAccount" /></div>
      <button id="saveBtn">ä¿å­˜</button>
      <button id="bindGoogleBtn" style="margin-top:10px; background:#4285F4; color:white;">
        ç»‘å®š Google è´¦å·
      </button>
      <button id="logoutBtn">é€€å‡ºç™»å½•</button>
    </div>
  </div>
</div>

                <!-- Google ç¿»è¯‘è¯­è¨€æ¡†ï¼ˆè¯·æ”¾åœ¨æœ€å¤–é¢ï¼Œä¸åµŒå¥—åœ¨ä¸Šé¢çš„ div ä¸­ï¼‰ -->
                <div id="google_translate_element" style="
                    position: absolute;
                    top: 50px;
                    right: 0px;
                    display: none;
                    background: rgba(0, 0, 0, 0.8);
                    padding: 8px;
                    border-radius: 5px;
                    z-index: 9999;
                "></div>
                    </div>

<div class="main-container">
  <div class="sidebar">
    <h3>é»‘é“å·¥ä½œå®¤</h3>
    <ul id="sidebar-nav"></ul>
  </div>
	    <div><strong>æœ‰</strong></div>
		<div><strong>å½©</strong></div>
		<div><strong>è›‹ï¼</strong></div>
		<div>ç‚¹</div>
		<div>é‡‘</div>
		<div>è‰²</div>
		<div>â€œé»‘</div>
		<div>é“</div>
		<div>å·¥</div>
		<div>ä½œ</div>
		<div>å®¤â€</div>

<!-- åŠ¨æ€åŠ è½½ nav.html -->
<script>
  fetch("../nav/nav.html")
    .then(r => r.text())
    .then(html => {
      document.getElementById("sidebar-nav").innerHTML = html;
    })
    .catch(err => console.error("èœå•åŠ è½½å¤±è´¥ï¼š", err));
</script>
	
<video id="bgm" autoplay loop muted playsinline width="0" height="0">
  <source src="https://htcb-12c7.github.io/htgov/assets/365.mp4" type="video/mp4">
</video>

<script>
  // ç”¨æˆ·ç‚¹å‡»åè§£é™¤é™éŸ³
function enableBgm() {
  const bgm = document.getElementById('bgm');
  if (bgm) {
    bgm.muted = false;
    bgm.play().catch(err => console.log("æ’­æ”¾å¤±è´¥ï¼š", err));
  }
}

// ç›‘å¬æ•´ä¸ªæ–‡æ¡£
document.addEventListener('click', enableBgm, { once: true });
// ç›‘å¬é”®ç›˜æŒ‰é”®
document.addEventListener('keydown', enableBgm, { once: true });
// ç›‘å¬è§¦æ‘¸ï¼ˆæ‰‹æœºç”¨ï¼‰
document.addEventListener('touchstart', enableBgm, { once: true });
</script>
			
  <script>
    function googleTranslateElementInit() {
      new google.translate.TranslateElement({
        pageLanguage: 'zh-CN',
        includedLanguages: 'zh-CN,en,ja,ko,fr,es,de,ru',
        layout: google.translate.TranslateElement.InlineLayout.SIMPLE
      }, 'google_translate_element');
    }

    document.getElementById("lang-toggle").onclick = () => {
      const el = document.getElementById("google_translate_element");
      el.style.display = el.style.display === "none" ? "block" : "none";
    };

    function toggleAccountInfo() {
      const popup = document.getElementById('accountPopup');
      popup.style.display = popup.style.display === 'none' ? 'block' : 'none';
    }
// é˜²æ­¢ cb ä¸è§¦å‘ï¼Œæ‰‹åŠ¨è§¦å‘ä¸€æ¬¡
  setTimeout(() => {
    if (typeof google === 'object' && typeof google.translate === 'object') {
      googleTranslateElementInit();
    }
  }, 270);
  </script>
		    
<!-- å·¦ä¸‹è§’ iframe åµŒå…¥å±•ç¤ºå…¶ä»–ä»“åº“é¡µé¢ -->
<!-- <div style="position: fixed; top: 60px; left: 250px; width: 85%; height: 95%;max-width: 100%; max-height: 100%; border: 0px solid gold; box-shadow: 0 0 8px #000; z-index: 9997;">
  <iframe 
    src="https://htcb-12c7.github.io/htgov/HTcalendar/HTcalendar_7.html" 
    width="100%" height="100%" frameborder="0"
    style="border: none;">
  </iframe>
</div> -->

<!-- ä¿®æ”¹ä¸»é¡µé¢çš„iframeå®¹å™¨ -->
<div id="iframe-container" style="position: fixed; top: 60px; left: 250px; width: 85%; height: 95%;max-width: 100%; max-height: 100%; border: 0px solid gold; box-shadow: 0 0 8px #000; z-index: 9997;">
  <!-- åœ¨iframeä¸Šæ–¹æ·»åŠ åˆ‡æ¢æŒ‰é’® -->
  <div style="position: absolute; top: 10px; left: 10px; z-index: 9998;">
    <button id="iframe-switch-btn" style="
      background: #ff4444;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 20px;
      cursor: pointer;
      font-weight: bold;
      font-size: 14px;
      transition: all 0.3s ease;
      box-shadow: 0 2px 5px rgba(0,0,0,0.3);
    ">
      â±ï¸ åˆ‡æ¢åˆ°è®¡æ—¶å™¨
    </button>
  </div>
  
  <iframe 
    src="https://htcb-12c7.github.io/htgov/HTcalendar/HTcalendar_7.html" 
    width="100%" height="100%" frameborder="0"
    style="border: none;">
  </iframe>
</div>

<!-- åœ¨ç°æœ‰æ—¶é’ŸåŒºåŸŸä¸‹æ–¹æ·»åŠ æ­¤ä»£ç  -->
<div class="timer-container">
  <div class="timer-controls">
    <button id="stopwatch-btn" class="timer-mode-btn active">ç§’è¡¨</button>
    <button id="countdown-btn" class="timer-mode-btn">å€’è®¡æ—¶</button>
  </div>
  
  <!-- ç§’è¡¨ç•Œé¢ -->
  <div id="stopwatch-section" class="timer-section active">
    <div class="time-display" id="stopwatch-display">00:00:00.00</div>
    <div class="stopwatch-controls">
      <button id="start-stopwatch" class="control-btn">å¼€å§‹</button>
      <button id="lap-stopwatch" class="control-btn" disabled>è®¡æ¬¡</button>
      <button id="reset-stopwatch" class="control-btn">é‡ç½®</button>
    </div>
    <div id="lap-times" class="lap-container"></div>
  </div>
  
  <!-- å€’è®¡æ—¶ç•Œé¢ -->
  <div id="countdown-section" class="timer-section">
    <div class="time-display" id="countdown-display">00:05:00</div>
    
    <div class="time-setup">
      <div class="time-input-group">
        <input type="number" id="hours-input" min="0" max="99" value="0">
        <span>æ—¶</span>
      </div>
      <div class="time-input-group">
        <input type="number" id="minutes-input" min="0" max="59" value="5">
        <span>åˆ†</span>
      </div>
      <div class="time-input-group">
        <input type="number" id="seconds-input" min="0" max="59" value="0">
        <span>ç§’</span>
      </div>
    </div>
    
    <div class="quick-presets">
      <button class="preset-btn" data-minutes="1">1åˆ†é’Ÿ</button>
      <button class="preset-btn" data-minutes="5">5åˆ†é’Ÿ</button>
      <button class="preset-btn" data-minutes="10">10åˆ†é’Ÿ</button>
      <button class="preset-btn" data-minutes="15">15åˆ†é’Ÿ</button>
      <button class="preset-btn" data-minutes="30">30åˆ†é’Ÿ</button>
    </div>
    
    <div class="reminder-options">
      <label>æé†’æ–¹å¼:</label>
      <div class="reminder-buttons">
        <button id="popup-reminder" class="reminder-btn active">å¼¹çª—æé†’</button>
        <button id="no-popup-reminder" class="reminder-btn">ä¸å¼¹çª—</button>
      </div>
    </div>
    
    <div class="countdown-controls">
      <button id="start-countdown" class="control-btn">å¼€å§‹</button>
      <button id="pause-countdown" class="control-btn" disabled>æš‚åœ</button>
      <button id="reset-countdown" class="control-btn">é‡ç½®</button>
    </div>
  </div>
</div>

<!-- å…¨å±æé†’è¦†ç›–å±‚ -->
<div id="fullscreen-alert" class="fullscreen-alert">
  <div class="alert-content">
    <h1>æ—¶é—´åˆ°ï¼</h1>
    <p>å€’è®¡æ—¶å·²å®Œæˆ</p>
    <p class="hint">æŒ‰ä»»æ„é”®æˆ–ç‚¹å‡»ä»»æ„ä½ç½®ç»§ç»­</p>
  </div>
</div>
<!-- åœ¨è®¡æ—¶å™¨å®¹å™¨ä¹‹å‰æ·»åŠ  -->
<div style="
  display: flex;
  align-items: center;
  justify-content: center;
  margin-bottom: 20px;
  gap: 15px;
">
  <span style="color: white; font-size: 16px;">æ˜¾ç¤ºæ¨¡å¼:</span>

  <span id="toggle-label" style="color: white; font-size: 16px;">è®¡æ—¶å™¨æ¨¡å¼</span>
</div>
  <!-- âœ… å¤´åƒå¼¹å‡ºä¿¡æ¯å¡ç‰‡é€»è¾‘ -->
        <script>
          function toggleAccountInfo() {
            const popup = document.getElementById('accountPopup');
            popup.style.display = popup.style.display === 'none' ? 'block' : 'none';
          }
        </script>
<!-- Firebase ç™»å½•é€»è¾‘ -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
  import { getAuth, signInWithEmailAndPassword, signInWithPopup,
    GoogleAuthProvider, updateEmail, sendEmailVerification,
    linkWithPopup, onAuthStateChanged, signOut } 
    from "https://www.gstatic.com/firebasejs/9.6.1/firebase-auth.js";
  import { getDatabase, ref, set, get } 
    from "https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js";
  import { getStorage, ref as sRef, uploadBytes, getDownloadURL } 
    from "https://www.gstatic.com/firebasejs/9.6.1/firebase-storage.js";

  const firebaseConfig = {
    apiKey: "AIzaSyCDKAAxNpKqcSsS2onwlKANl9tLmCy6UGo",
    authDomain: "ht-chat-91e5f.firebaseapp.com",
    databaseURL: "https://ht-chat-91e5f-default-rtdb.firebaseio.com",
    projectId: "ht-chat-91e5f",
    storageBucket: "ht-chat-91e5f.firebasestorage.app",
    messagingSenderId: "325331727527",
    appId: "1:325331727527:web:d994b7241a7cc28e9dd782",
    measurementId: "G-VYV13LWP14"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getDatabase(app);
  const provider = new GoogleAuthProvider();
  const storage = getStorage(app);

  // âœ… ç™»å½•
  document.getElementById("loginBtn").onclick = async () => {
    const email = document.getElementById("email").value;
    const password = document.getElementById("password").value;
    try {
      await signInWithEmailAndPassword(auth, email, password);
    } catch (err) {
      alert("ç™»å½•å¤±è´¥: " + err.message);
    }
  };

  // âœ… Google ç™»å½•
  document.getElementById("googleLoginBtn").onclick = async () => {
    try {
      await signInWithPopup(auth, provider);
    } catch (err) {
      alert("Google ç™»å½•å¤±è´¥: " + err.message);
    }
  };

  // âœ… ç»‘å®š Google
  document.getElementById("bindGoogleBtn").onclick = async () => {
    const user = auth.currentUser;
    if (!user) return alert("è¯·å…ˆç™»å½•");
    try {
      await linkWithPopup(user, provider);
      alert("Google è´¦å·ç»‘å®šæˆåŠŸï¼");
    } catch (err) {
      alert("ç»‘å®šå¤±è´¥: " + err.message);
    }
  };

  // âœ… é‚®ç®±éªŒè¯
  document.getElementById("sendVerifyBtn").onclick = async () => {
    const user = auth.currentUser;
    if (!user) return alert("è¯·å…ˆç™»å½•");
    const newEmail = document.getElementById("userEmail").value;
    try {
      await updateEmail(user, newEmail);
      await sendEmailVerification(user);
      alert("éªŒè¯é‚®ä»¶å·²å‘é€ï¼Œè¯·æ£€æŸ¥é‚®ç®±");
    } catch (err) {
      alert("å‘é€å¤±è´¥: " + err.message);
    }
  };

  // âœ… ä¿å­˜ç”¨æˆ·ä¿¡æ¯ + ä¸Šä¼ å¤´åƒ
  let newAvatarFile = null;
  document.getElementById("updateAvatar").addEventListener("change", function(e) {
    const file = e.target.files[0];
    if (!file) return;
    if (file.size > 7 * 1024 * 1024) {
      alert("å›¾ç‰‡å¤§å°ä¸èƒ½è¶…è¿‡27MBï¼");
      return;
    }
    newAvatarFile = file;
    document.getElementById("userPhotoPreview").src = URL.createObjectURL(file);
  });

  document.getElementById("saveBtn").onclick = async () => {
    const user = auth.currentUser;
    if (!user) return alert("è¯·å…ˆç™»å½•");

    let avatarURL = document.getElementById("userPhoto").src;

    if (newAvatarFile) {
      const fileRef = sRef(storage, "avatars/" + user.uid + ".jpg");
      await uploadBytes(fileRef, newAvatarFile);
      avatarURL = await getDownloadURL(fileRef);
      document.getElementById("userPhoto").src = avatarURL;
    }

    const userRef = ref(db, "users/" + user.uid);
    await set(userRef, {
      nickname: document.getElementById("userNickname").value,
      email: document.getElementById("userEmail").value,
      payMethod: document.getElementById("userPayMethod").value,
      payName: document.getElementById("userPayName").value,
      payAccount: document.getElementById("userPayAccount").value,
      avatar: avatarURL
    });

    alert("ä¿¡æ¯å·²æ›´æ–°ï¼");
  };

  // âœ… ç™»å‡º
  document.getElementById("logoutBtn").onclick = () => {
    signOut(auth);
  };

  // âœ… ç™»å½•çŠ¶æ€ç›‘å¬
  onAuthStateChanged(auth, async (user) => {
    if (user) {
      document.getElementById("loginForm").style.display = "none";
      document.getElementById("userInfo").style.display = "block";
      document.getElementById("userPhoto").src = user.photoURL || "https://htcb-12c7.github.io/htgov/assets/HTgovIconV2.png";

      const userRef = ref(db, "users/" + user.uid);
      const snapshot = await get(userRef);
      if (snapshot.exists()) {
        const data = snapshot.val();
        document.getElementById("userNickname").value = data.nickname || "";
        document.getElementById("userEmail").value = data.email || user.email || "";
        document.getElementById("userPayMethod").value = data.payMethod || "";
        document.getElementById("userPayName").value = data.payName || "";
        document.getElementById("userPayAccount").value = data.payAccount || "";

        document.getElementById("userPhoto").src = data.avatar || user.photoURL || "https://htcb-12c7.github.io/htgov/assets/login-placeholder.svg";
        document.getElementById("userPhotoPreview").src = data.avatar || user.photoURL || "https://htcb-12c7.github.io/htgov/assets/login-placeholder.svg";
      }
    } else {
      document.getElementById("loginForm").style.display = "block";
      document.getElementById("userInfo").style.display = "none";
      document.getElementById("userPhoto").src = "https://htcb-12c7.github.io/htgov/assets/login-placeholder.svg";
    }
  });
</script>
	
<script>
// è®¡æ—¶å™¨å˜é‡
let stopwatchInterval = null;
let stopwatchTime = 0;
let stopwatchRunning = false;
let lapTimes = [];

let countdownInterval = null;
let countdownTime = 300; // é»˜è®¤5åˆ†é’Ÿ
let originalCountdownTime = 300;
let countdownRunning = false;
let reminderType = 'popup'; // é»˜è®¤å¼¹çª—æé†’

// DOMå…ƒç´ 
const stopwatchBtn = document.getElementById('stopwatch-btn');
const countdownBtn = document.getElementById('countdown-btn');
const stopwatchSection = document.getElementById('stopwatch-section');
const countdownSection = document.getElementById('countdown-section');
const stopwatchDisplay = document.getElementById('stopwatch-display');
const countdownDisplay = document.getElementById('countdown-display');
const startStopwatchBtn = document.getElementById('start-stopwatch');
const lapStopwatchBtn = document.getElementById('lap-stopwatch');
const resetStopwatchBtn = document.getElementById('reset-stopwatch');
const lapTimesContainer = document.getElementById('lap-times');
const startCountdownBtn = document.getElementById('start-countdown');	
const pauseCountdownBtn = document.getElementById('pause-countdown');
const resetCountdownBtn = document.getElementById('reset-countdown');
const hoursInput = document.getElementById('hours-input');
const minutesInput = document.getElementById('minutes-input');
const secondsInput = document.getElementById('seconds-input');
const presetBtns = document.querySelectorAll('.preset-btn');
const popupReminderBtn = document.getElementById('popup-reminder');
const noPopupReminderBtn = document.getElementById('no-popup-reminder');
const fullscreenAlert = document.getElementById('fullscreen-alert');

// è®¡æ—¶å™¨æ¨¡å¼åˆ‡æ¢
stopwatchBtn.addEventListener('click', () => {
  stopwatchBtn.classList.add('active');
  countdownBtn.classList.remove('active');
  stopwatchSection.classList.add('active');
  countdownSection.classList.remove('active');
});

countdownBtn.addEventListener('click', () => {
  countdownBtn.classList.add('active');
  stopwatchBtn.classList.remove('active');
  countdownSection.classList.add('active');
  stopwatchSection.classList.remove('active');
});

// ç§’è¡¨åŠŸèƒ½
function formatStopwatchTime(ms) {
  const hours = Math.floor(ms / 3600000);
  const minutes = Math.floor((ms % 3600000) / 60000);
  const seconds = Math.floor((ms % 60000) / 1000);
  const milliseconds = Math.floor((ms % 1000) / 10);
  
  return `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}.${milliseconds.toString().padStart(2, '0')}`;
}

function updateStopwatchDisplay() {
  stopwatchDisplay.textContent = formatStopwatchTime(stopwatchTime);
}

function startStopwatch() {
  if (!stopwatchRunning) {
    const startTime = Date.now() - stopwatchTime;
    
    stopwatchInterval = setInterval(() => {
      stopwatchTime = Date.now() - startTime;
      updateStopwatchDisplay();
    }, 10);
    
    stopwatchRunning = true;
    startStopwatchBtn.textContent = 'æš‚åœ';
    lapStopwatchBtn.disabled = false;
  } else {
    clearInterval(stopwatchInterval);
    stopwatchRunning = false;
    startStopwatchBtn.textContent = 'ç»§ç»­';
  }
}

function lapStopwatch() {
  if (stopwatchRunning) {
    lapTimes.push({
      time: stopwatchTime,
      display: formatStopwatchTime(stopwatchTime)
    });
    
    updateLapTimes();
  }
}

function resetStopwatch() {
  clearInterval(stopwatchInterval);
  stopwatchTime = 0;
  stopwatchRunning = false;
  lapTimes = [];
  updateStopwatchDisplay();
  updateLapTimes();
  startStopwatchBtn.textContent = 'å¼€å§‹';
  lapStopwatchBtn.disabled = true;
}

function updateLapTimes() {
  lapTimesContainer.innerHTML = '';
  
  lapTimes.forEach((lap, index) => {
    const lapItem = document.createElement('div');
    lapItem.className = 'lap-item';
    lapItem.textContent = `è®¡æ¬¡ ${index + 1}: ${lap.display}`;
    lapTimesContainer.appendChild(lapItem);
  });
}

startStopwatchBtn.addEventListener('click', startStopwatch);
lapStopwatchBtn.addEventListener('click', lapStopwatch);
resetStopwatchBtn.addEventListener('click', resetStopwatch);

// å€’è®¡æ—¶åŠŸèƒ½
function formatCountdownTime(seconds) {
  const hours = Math.floor(seconds / 3600);
  const minutes = Math.floor((seconds % 3600) / 60);
  const secs = seconds % 60;
  
  return `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
}

function updateCountdownDisplay() {
  countdownDisplay.textContent = formatCountdownTime(countdownTime);
}

function updateCountdownFromInputs() {
  const hours = parseInt(hoursInput.value) || 0;
  const minutes = parseInt(minutesInput.value) || 0;
  const seconds = parseInt(secondsInput.value) || 0;
  
  countdownTime = hours * 3600 + minutes * 60 + seconds;
  originalCountdownTime = countdownTime;
  updateCountdownDisplay();
}

function startCountdown() {
  if (countdownTime <= 0) return;
  
  if (!countdownRunning) {
    countdownInterval = setInterval(() => {
      if (countdownTime <= 0) {
        clearInterval(countdownInterval);
        countdownRunning = false;
        startCountdownBtn.textContent = 'å¼€å§‹';
        pauseCountdownBtn.disabled = true;
        
        // æ—¶é—´åˆ°ï¼Œæ ¹æ®è®¾ç½®æ˜¾ç¤ºæé†’
        if (reminderType === 'popup') {
          showFullscreenAlert();
        } else {
          // å¦‚æœä¸å¼¹çª—ï¼Œå¯ä»¥åœ¨è¿™é‡Œæ·»åŠ å…¶ä»–æé†’æ–¹å¼ï¼Œæ¯”å¦‚å£°éŸ³
          console.log('æ—¶é—´åˆ°ï¼');
        }
        return;
      }
      
      countdownTime--;
      updateCountdownDisplay();
    }, 1000);
    
    countdownRunning = true;
    startCountdownBtn.textContent = 'ç»§ç»­';
    pauseCountdownBtn.disabled = false;
    hoursInput.disabled = true;
    minutesInput.disabled = true;
    secondsInput.disabled = true;
  }
}

function pauseCountdown() {
  clearInterval(countdownInterval);
  countdownRunning = false;
  startCountdownBtn.textContent = 'å¼€å§‹';
  pauseCountdownBtn.disabled = true;
}

function resetCountdown() {
  clearInterval(countdownInterval);
  countdownTime = originalCountdownTime;
  countdownRunning = false;
  updateCountdownDisplay();
  startCountdownBtn.textContent = 'å¼€å§‹';
  pauseCountdownBtn.disabled = true;
  hoursInput.disabled = false;
  minutesInput.disabled = false;
  secondsInput.disabled = false;
}

// å¿«é€Ÿé¢„è®¾æŒ‰é’®
presetBtns.forEach(btn => {
  btn.addEventListener('click', () => {
    const minutes = parseInt(btn.getAttribute('data-minutes'));
    countdownTime = minutes * 60;
    originalCountdownTime = countdownTime;
    updateCountdownDisplay();
    
    // æ›´æ–°è¾“å…¥æ¡†
    hoursInput.value = 0;
    minutesInput.value = minutes;
    secondsInput.value = 0;
  });
});

// æé†’æ–¹å¼é€‰æ‹©
popupReminderBtn.addEventListener('click', () => {
  reminderType = 'popup';
  popupReminderBtn.classList.add('active');
  noPopupReminderBtn.classList.remove('active');
});

noPopupReminderBtn.addEventListener('click', () => {
  reminderType = 'no-popup';
  noPopupReminderBtn.classList.add('active');
  popupReminderBtn.classList.remove('active');
});

// å…¨å±æé†’
function showFullscreenAlert() {
  fullscreenAlert.style.display = 'flex';
  
  // ç‚¹å‡»ä»»æ„ä½ç½®å…³é—­
  const closeAlert = () => {
    fullscreenAlert.style.display = 'none';
    document.removeEventListener('click', closeAlert);
    document.removeEventListener('keydown', closeAlert);
  };
  
  document.addEventListener('click', closeAlert);
  document.addEventListener('keydown', closeAlert);
}

// è¾“å…¥æ¡†å˜åŒ–æ—¶æ›´æ–°å€’è®¡æ—¶
hoursInput.addEventListener('change', updateCountdownFromInputs);
minutesInput.addEventListener('change', updateCountdownFromInputs);
secondsInput.addEventListener('change', updateCountdownFromInputs);

// æŒ‰é’®äº‹ä»¶
startCountdownBtn.addEventListener('click', startCountdown);
pauseCountdownBtn.addEventListener('click', pauseCountdown);
resetCountdownBtn.addEventListener('click', resetCountdown);

// åˆå§‹åŒ–æ˜¾ç¤º
updateStopwatchDisplay();
updateCountdownDisplay();

// === é¡µé¢åˆ‡æ¢åŠŸèƒ½ ===
const toggleLabel = document.getElementById('toggle-label');
const iframeContainer = document.getElementById('iframe-container');
const timerContainer = document.querySelector('.timer-container');
const iframeSwitchBtn = document.getElementById('iframe-switch-btn');

// æ£€æŸ¥localStorageä¸­çš„çŠ¶æ€
if (localStorage.getItem('timerActive') === 'true') {
  // æ˜¾ç¤ºè®¡æ—¶å™¨ï¼Œéšè—IFARM
  iframeContainer.style.display = 'none';
  timerContainer.style.display = 'block';
  toggleLabel.textContent = 'å½“å‰ï¼šè®¡æ—¶å™¨æ¨¡å¼';
  toggleLabel.style.color = '#4CAF50';
} else {
  // æ˜¾ç¤ºIFARMï¼Œéšè—è®¡æ—¶å™¨
  iframeContainer.style.display = 'block';
  timerContainer.style.display = 'none';
  toggleLabel.textContent = 'å½“å‰ï¼šIFARMæ—¶é’Ÿ';
  toggleLabel.style.color = '#ff4444';
}

// iframeæŒ‰é’®ç‚¹å‡»äº‹ä»¶
iframeSwitchBtn.addEventListener('click', function() {
  iframeContainer.style.display = 'none';
  timerContainer.style.display = 'block';
  toggleLabel.textContent = 'å½“å‰ï¼šè®¡æ—¶å™¨æ¨¡å¼';
  toggleLabel.style.color = '#4CAF50';
  localStorage.setItem('timerActive', 'true');
});

// åœ¨è®¡æ—¶å™¨ä¸Šæ·»åŠ è¿”å›æŒ‰é’®
const timerControls = document.querySelector('.timer-controls');
if (!document.getElementById('back-to-iframe-btn')) {
  const backBtn = document.createElement('button');
  backBtn.id = 'back-to-iframe-btn';
  backBtn.textContent = 'ğŸ”™ è¿”å›IFARMæ—¶é’Ÿ';
  backBtn.className = 'timer-mode-btn';
  backBtn.style.cssText = 'margin-left:10px; background:#ff4444;';
  
  backBtn.addEventListener('click', function() {
    iframeContainer.style.display = 'block';
    timerContainer.style.display = 'none';
    toggleLabel.textContent = 'å½“å‰ï¼šIFARMæ—¶é’Ÿ';
    toggleLabel.style.color = '#ff4444';
    localStorage.setItem('timerActive', 'false');
  });
  
  timerControls.appendChild(backBtn);
}
// === é¡µé¢åˆ‡æ¢åŠŸèƒ½ç»“æŸ ===
</script>

</body>
</html>













