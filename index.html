<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>é»‘é“å·¥ä½œå®¤ç®€ä»‹</title>
  <link rel="stylesheet" href="css/htgov.css" />
  <style>
/* æ·±è‰²æŒ‰é’®æ ·å¼ï¼ˆé»‘åº•é‡‘è¾¹ï¼‰â€”â€”åªåœ¨å¤´åƒå¼¹çª—é‡Œç”Ÿæ•ˆ */
.account-popup button {
  background-color: #000000;
  color: #ffd700;
  border: 1px solid #ffd700;
  padding: 8px 16px;
  border-radius: 5px;
  cursor: pointer;
  font-weight: bold;
  transition: background 0.3s;
}
.account-popup button:hover {
  background-color: #2b2b2b;
  color: #fff8dc;
}

/* æ·±è‰²è¾“å…¥æ¡†æ ·å¼ï¼ˆæ¸å˜+å†…é˜´å½±ï¼‰â€”â€”åªåœ¨å¤´åƒå¼¹çª—é‡Œç”Ÿæ•ˆ */
.account-popup input {
  background: linear-gradient(145deg, #1e1e1e, #2b2b2b);
  color: #f5deb3;  /* æµ…ç±³é»„è‰²æ–‡å­— */
  border: 1px solid #8b6914; /* é‡‘æ£•è‰²è¾¹æ¡† */
  padding: 6px 10px;
  border-radius: 6px;
  outline: none;
  font-size: 14px;
  box-shadow: inset 2px 2px 5px rgba(0,0,0,0.8),
              inset -2px -2px 5px rgba(255,255,255,0.05);
  transition: all 0.3s ease;
}

/* èšç„¦æ—¶æ›´äº® */
.account-popup input:focus {
  border-color: #ffd700;
  box-shadow: 0 0 6px #ffd700, inset 1px 1px 3px rgba(0,0,0,0.6);
  background: linear-gradient(145deg, #252525, #333);
}
  </style>
</head>
<body>
  <div class="header">
    <a href="https://htcb-12c7.github.io/htgov/">
      <img class="logo" src="assets/HTgovIconV2.png" alt="è¿”å›ä¸»é¡µ">
    </a>
    é»‘é“å·¥ä½œå®¤å®˜ç½‘ <span>ã€#2552 æ­£å¼å¼€æ”¾ã€‘</span>

    <!-- Language æŒ‰é’® -->
    <button id="lang-toggle" style="
      position: absolute;
      top: 10px;
      right: 70px;
      padding: 8px 16px;
      font-size: 16px;
      /* å­—ä½“å¤§å° */
      background: black;
      color: #03a9f4;
      border: 1px solid #03a9f4;
      border-radius: 5px;
      cursor: pointer;
      font-weight: bold;
    ">
      ğŸŒ Language
    </button>

    <!-- å¤´åƒ + å¼¹å‡ºå¡ç‰‡ -->
    <div class="account-toggle" style="position: absolute; top: 10px; right: 10px;">
      <img id="userPhoto" src="assets/login-placeholder.svg" alt="å¤´åƒ"
        style="width: 40px; height: 40px; border-radius: 50%; cursor: pointer;"
        onclick="toggleAccountInfo()" />

      <div class="account-popup" id="accountPopup" style="
        display: none;
        position: absolute;
        top: 45px;
        right: 0;
        background: rgba(0,0,0,0.9);
        padding: 10px 15px;
        border-radius: 8px;
        color: white;
        z-index: 9999;
        box-shadow: 0 0 10px rgba(0,0,0,0.5);
        white-space: nowrap;
      ">

        <!-- æœªç™»å½•æ˜¾ç¤ºç™»å½•è¡¨å• -->
        <div id="loginForm">
          <input type="email" id="email" placeholder="é‚®ç®±/ç”¨æˆ·å" style="width: 150px; margin: 3px;" />
          <input type="password" id="password" placeholder="å¯†ç " style="width: 150px; margin: 3px;" />
          <button id="loginBtn">ç™»å½•</button>
          <button id="googleLoginBtn" style="background:#fff; color:#000; margin-top:5px;">ä½¿ç”¨ Google ç™»å½•</button>
        </div>

        <!-- ç™»å½•åæ˜¾ç¤º/ä¿®æ”¹ç”¨æˆ·ä¿¡æ¯ -->
        <div id="userInfo" style="display:none;">
          
  <!-- âœ… æ–°å¢å¤´åƒä¸Šä¼  -->
  <div>
    <label>å¤´åƒï¼š</label>
    <input type="file" id="updateAvatar" accept="image/*" />
    <img id="userPhotoPreview" 
         src="assets/login-placeholder.svg"
         style="width:60px; height:60px; border-radius:50%; margin-top:5px;" />
  </div>
          <div><strong>æ˜µç§°ï¼š</strong><input id="userNickname" /></div>
          <div>
            <strong>é‚®ç®±ï¼š</strong>
            <input id="userEmail" style="width:200px;" />
            <button id="sendVerifyBtn" style="margin-left:5px;">å‘é€éªŒè¯é‚®ä»¶</button>
          </div>
          <div><strong>æ”¯ä»˜æ–¹å¼ï¼š</strong><input id="userPayMethod" /></div>
          <div><strong>æ”¯ä»˜åç§°ï¼š</strong><input id="userPayName" /></div>
          <div><strong>æ”¯ä»˜è´¦å·ï¼š</strong><input id="userPayAccount" /></div>
          <button id="saveBtn">ä¿å­˜</button>
          <button id="bindGoogleBtn" style="margin-top:10px; background:#4285F4; color:white;">
            ç»‘å®š Google è´¦å·
          </button>
          <button id="logoutBtn">é€€å‡ºç™»å½•</button>
        </div>

        <!-- Google ç¿»è¯‘è¯­è¨€æ¡†ï¼ˆè¯·æ”¾åœ¨æœ€å¤–é¢ï¼Œä¸åµŒå¥—åœ¨ä¸Šé¢çš„ div ä¸­ï¼‰ -->
        <div id="google_translate_element" style="
          position: absolute;
          top: 50px;
          right: 0px;
          display: none;
          background: rgba(0, 0, 0, 0.8);
          padding: 8px;
          border-radius: 5px;
          z-index: 9999;
        "></div>
      </div>
    </div>
  </div>

  <div class="main-container">
    <!-- å·¦ä¾§å¯¼èˆª -->
    <div class="sidebar">
      <h3>é»‘é“å·¥ä½œå®¤</h3>
      <ul id="sidebar-nav"></ul>
    </div>

    <div class="content" style="display:flex; justify-content:center; align-items:flex-start; padding:40px;">
      <div class="container" style="max-width:800px;">
        <h2>é»‘é“å·¥ä½œå®¤ç®€ä»‹</h2>
        <p>é»‘é“å·¥ä½œå®¤ï¼ˆHT Studioï¼‰æ˜¯ä¸€ä¸ªé›†åˆ›æ„å¼€å‘ã€æå®¢æŠ€æœ¯ä¸ç‹¬ç«‹é¡¹ç›®å®è·µä¸ºä¸€ä½“çš„è‡ªç”±å›¢é˜Ÿã€‚æˆ‘ä»¬è‡´åŠ›äºæ‰“é€ å…·æœ‰å®æˆ˜ä»·å€¼ä¸å¨±ä¹æ€§çš„é¡¹ç›®ï¼ŒåŒ…æ‹¬ä½†ä¸é™äºï¼š</p>
        <ul>
          <li>çº¢å¸½ / ç™½å¸½é»‘å®¢å·¥å…·</li>
          <li>EXE è½¯ä»¶ & ç½‘é¡µäº¤äº’å·¥å…·</li>
          <li>å’Œå¹³ç²¾è‹±ç­‰æ¸¸æˆè¾…åŠ©ã€æ¨¡æ‹Ÿé£è¡Œä½“éªŒ</li>
          <li>è‡ªåª’ä½“å†…å®¹è¿è¥ã€AI è„šæœ¬ç ”ç©¶</li>
        </ul>
        <p>æˆ‘ä»¬å´‡å°šè‡ªç”±æ¢ç´¢ã€æŠ€æœ¯ç¾å­¦å’Œæè‡´ç»†èŠ‚ã€‚æ¬¢è¿æœ‰å¿—è€…åŠ å…¥ï¼Œå…±å»ºé»‘é“å®‡å®™ï¼</p>
        <h2>é»‘é“å®˜ç½‘ï¼ˆHTgovï¼‰æ•™ç¨‹</h2>
        
          <p>1.å·¦ä¸Šè§’å›¾æ ‡ â€”â€” è¿”å›ä¸»é¡µ</p>
          <p>2.å³ä¸Šè§’å›¾æ ‡ â€”â€” ç™»å½•/è´¦æˆ·ä¿¡æ¯</p>
          <p>3.ç»Ÿä¸€å¯¼èˆªæ ç‚¹å‡»è·³è½¬ï¼Œå¤§å®¶éƒ½çŸ¥é“ï¼ˆé™¤äº†ç‰¹æ®Šé¡µé¢ä»¥åŠã€é»‘é“äºŒç»´ç å·¥å…·ã€‘é¡µé¢ï¼‰</p>
          <p>4.å¸¦ä¸‹æ»‘çº¿/è“è‰² æ–‡å­—æ˜¯è¶…é“¾æ¥ï¼Œç‚¹å‡»å³å¯è·³è½¬</p>
          <p>5.æ²¡æœ‰è®¾ç½®ï¼Œæœ‰äº‹è”ç³»ï¼ˆæŒ‰ä¼˜å…ˆé¡ºåºæ’åºï¼‰ï¼š</p>
        
        <ul>
          <li>é‚®ç®±ï¼šb_HTc@outlook.com/1114878@lwsd.org/sh_cqxipadyx@163.com</li>
          <li>ç”µè¯ï¼š+1 4254712471</li>
          <li>çŸ­ä¿¡ï¼š+86 15317842061</li>
        </ul>
        
      </div>
    </div>
  </div>

  <!-- åŠ¨æ€åŠ è½½ nav.html -->
  <script>
    fetch("nav/nav.html")
      .then(r => r.text())
      .then(html => {
        document.getElementById("sidebar-nav").innerHTML = html;
      })
      .catch(err => console.error("èœå•åŠ è½½å¤±è´¥ï¼š", err));
  </script>

  <!-- âœ… Google è¯­è¨€é€‰æ‹©åˆå§‹åŒ– -->
  <script>
    function googleTranslateElementInit() {
      new google.translate.TranslateElement({
        pageLanguage: 'zh-CN',
        includedLanguages: 'zh-CN,en,ja,ko,fr,es,de,ru',
        layout: google.translate.TranslateElement.InlineLayout.SIMPLE
      }, 'google_translate_element');
    }
  </script>

  <!-- âœ… Google æä¾›çš„ç¿»è¯‘ç»„ä»¶ -->
  <script src="https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>

  <!-- âœ… æ§åˆ¶ Language æŒ‰é’®ç‚¹å‡»æ—¶æ˜¾ç¤º/éšè—è¯­è¨€æ¡† -->
  <script>
    window.addEventListener('load', function () {
      const toggle = document.getElementById("lang-toggle");
      const box = document.getElementById("google_translate_element");
      if (toggle && box) {
        toggle.addEventListener("click", () => {
          box.style.display = box.style.display === "none" ? "block" : "none";
        });
      }
    });
  </script>

  <!-- âœ… å¤´åƒå¼¹å‡ºä¿¡æ¯å¡ç‰‡é€»è¾‘ -->
  <script>
    function toggleAccountInfo() {
      const popup = document.getElementById('accountPopup');
      popup.style.display = popup.style.display === 'none' ? 'block' : 'none';
    }
  </script>

  <!-- Firebase ç™»å½•é€»è¾‘ -->
  <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
import { getAuth, signInWithEmailAndPassword, signInWithPopup,
  GoogleAuthProvider, updateEmail, sendEmailVerification,
  linkWithPopup, onAuthStateChanged, signOut } 
  from "https://www.gstatic.com/firebasejs/9.6.1/firebase-auth.js";
import { getDatabase, ref, set, get } 
  from "https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js";
import { getStorage, ref as sRef, uploadBytes, getDownloadURL } 
  from "https://www.gstatic.com/firebasejs/9.6.1/firebase-storage.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCDKAAxNpKqcSsS2onwlKANl9tLmCy6UGo",
      authDomain: "ht-chat-91e5f.firebaseapp.com",
      databaseURL: "https://ht-chat-91e5f-default-rtdb.firebaseio.com",
      projectId: "ht-chat-91e5f",
      storageBucket: "ht-chat-91e5f.firebasestorage.app",
      messagingSenderId: "325331727527",
      appId: "1:325331727527:web:d994b7241a7cc28e9dd782",
      measurementId: "G-VYV13LWP14"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getDatabase(app);
    const provider = new GoogleAuthProvider();

    // âœ… åˆ‡æ¢å¼¹çª—æ˜¾ç¤º
    window.toggleAccountInfo = function () {
      const popup = document.getElementById('accountPopup');
      popup.style.display = popup.style.display === 'none' ? 'block' : 'none';
    };

    // âœ… é‚®ç®±/ç”¨æˆ·å ç™»å½•
    document.getElementById("loginBtn").onclick = async () => {
      const email = document.getElementById("email").value;
      const password = document.getElementById("password").value;
      try {
        await signInWithEmailAndPassword(auth, email, password);
      } catch (err) {
        alert("ç™»å½•å¤±è´¥: " + err.message);
      }
    };

    // âœ… Google ç™»å½•
    document.getElementById("googleLoginBtn").onclick = async () => {
      try {
        await signInWithPopup(auth, provider);
      } catch (err) {
        alert("Google ç™»å½•å¤±è´¥: " + err.message);
      }
    };

    // âœ… ç»‘å®š Google è´¦å·
    document.getElementById("bindGoogleBtn").onclick = async () => {
      const user = auth.currentUser;
      if (!user) return alert("è¯·å…ˆç™»å½•");
      try {
        await linkWithPopup(user, provider);
        alert("Google è´¦å·ç»‘å®šæˆåŠŸï¼");
      } catch (err) {
        alert("ç»‘å®šå¤±è´¥: " + err.message);
      }
    };

    // âœ… å‘é€é‚®ç®±éªŒè¯
    document.getElementById("sendVerifyBtn").onclick = async () => {
      const user = auth.currentUser;
      if (!user) return alert("è¯·å…ˆç™»å½•");
      const newEmail = document.getElementById("userEmail").value;
      try {
        await updateEmail(user, newEmail);
        await sendEmailVerification(user);
        alert("éªŒè¯é‚®ä»¶å·²å‘é€ï¼Œè¯·æ£€æŸ¥é‚®ç®±å¹¶ç¡®è®¤");
      } catch (err) {
        alert("å‘é€å¤±è´¥: " + err.message);
      }
    };

    // âœ… ä¿å­˜ç”¨æˆ·ä¿¡æ¯
const storage = getStorage(app);

document.getElementById("saveBtn").onclick = async () => {
  const user = auth.currentUser;
  if (!user) return alert("è¯·å…ˆç™»å½•");

  let avatarURL = document.getElementById("userPhoto").src;

  // å¦‚æœæœ‰æ–°å¤´åƒæ–‡ä»¶ï¼Œä¸Šä¼ å¹¶è·å–ä¸‹è½½åœ°å€
  if (newAvatarFile) {
    const fileRef = sRef(storage, "avatars/" + user.uid + ".jpg");
    await uploadBytes(fileRef, newAvatarFile);
    avatarURL = await getDownloadURL(fileRef);
    document.getElementById("userPhoto").src = avatarURL; // æ›´æ–°å¤´åƒ
  }

  // ä¿å­˜æ•°æ®åº“ä¿¡æ¯
  const userRef = ref(db, "users/" + user.uid);
  await set(userRef, {
    nickname: document.getElementById("userNickname").value,
    email: document.getElementById("userEmail").value,
    payMethod: document.getElementById("userPayMethod").value,
    payName: document.getElementById("userPayName").value,  // âœ… ç°åœ¨ä¸ä¼šæŠ¥é”™äº†
    payAccount: document.getElementById("userPayAccount").value,
    avatar: avatarURL
  });

  alert("ä¿¡æ¯å·²æ›´æ–°ï¼");
};

    // âœ… ç™»å‡º
    document.getElementById("logoutBtn").onclick = () => {
      signOut(auth);
    };

    // âœ… ç™»å½•çŠ¶æ€ç›‘å¬
    onAuthStateChanged(auth, async (user) => {
      if (user) {
        document.getElementById("loginForm").style.display = "none";
        document.getElementById("userInfo").style.display = "block";
        document.getElementById("userPhoto").src = user.photoURL || "assets/HTgovIconV2.png";

        // ä»æ•°æ®åº“åŠ è½½ç”¨æˆ·ä¿¡æ¯
        const userRef = ref(db, "users/" + user.uid);
        const snapshot = await get(userRef);
        if (snapshot.exists()) {
          const data = snapshot.val();
          document.getElementById("userNickname").value = data.nickname || "";
          document.getElementById("userEmail").value = data.email || user.email || "";
          document.getElementById("userPayMethod").value = data.payMethod || "";
          document.getElementById("userPayName").value = data.payName || ""; // æ–°å¢
          document.getElementById("userPayAccount").value = data.payAccount || "";

          // âœ… åœ¨è¿™é‡ŒåŠ å¤´åƒé¢„è§ˆåŒæ­¥
      document.getElementById("userPhoto").src = data.avatar || user.photoURL || "assets/login-placeholder.svg";
      document.getElementById("userPhotoPreview").src = data.avatar || user.photoURL || "assets/login-placeholder.svg";
        }
      } else {
        document.getElementById("loginForm").style.display = "block";
        document.getElementById("userInfo").style.display = "none";
        document.getElementById("userPhoto").src = "assets/login-placeholder.svg";
      }
    });

let newAvatarFile = null;

document.getElementById("updateAvatar").addEventListener("change", function(e) {
  const file = e.target.files[0];
  if (!file) return;
  if (file.size > 2 * 1024 * 1024) {
    alert("å›¾ç‰‡å¤§å°ä¸èƒ½è¶…è¿‡2MBï¼");
    return;
  }
  newAvatarFile = file;
  document.getElementById("userPhotoPreview").src = URL.createObjectURL(file);
});  
    
  </script>
</body>
</html>
